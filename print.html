<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Openartcoded - Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> About this project</a></li><li class="chapter-item expanded "><a href="features/index.html"><strong aria-hidden="true">2.</strong> Features &amp; Technology stack</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="features/website.html"><strong aria-hidden="true">2.1.</strong> Website</a></li><li class="chapter-item expanded "><a href="features/backoffice.html"><strong aria-hidden="true">2.2.</strong> Backoffice</a></li></ol></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/compiled.html"><strong aria-hidden="true">3.1.</strong> Frontend development</a></li><li class="chapter-item expanded "><a href="installation/monorepo.html"><strong aria-hidden="true">3.2.</strong> Full-Stack Development</a></li><li class="chapter-item expanded "><a href="installation/production/index.html"><strong aria-hidden="true">3.3.</strong> Production</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference guide</li><li class="chapter-item expanded "><a href="events/index.html"><strong aria-hidden="true">4.</strong> Events</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="events/expense-received.html"><strong aria-hidden="true">4.1.</strong> ExpenseReceived</a></li><li class="chapter-item expanded "><a href="events/expense-label-updated.html"><strong aria-hidden="true">4.2.</strong> ExpenseLabelUpdated</a></li><li class="chapter-item expanded "><a href="events/expense-price-updated.html"><strong aria-hidden="true">4.3.</strong> ExpensePriceUpdated</a></li><li class="chapter-item expanded "><a href="events/expense-removed.html"><strong aria-hidden="true">4.4.</strong> ExpenseRemoved</a></li><li class="chapter-item expanded "><a href="events/expense-attach-removed.html"><strong aria-hidden="true">4.5.</strong> ExpenseAttachmentRemoved</a></li><li class="chapter-item expanded "><a href="events/invoice-generated.html"><strong aria-hidden="true">4.6.</strong> InvoiceGenerated</a></li><li class="chapter-item expanded "><a href="events/invoice-removed.html"><strong aria-hidden="true">4.7.</strong> InvoiceRemoved</a></li><li class="chapter-item expanded "><a href="events/invoice-restored.html"><strong aria-hidden="true">4.8.</strong> InvoiceRestored</a></li><li class="chapter-item expanded "><a href="events/dossier-created.html"><strong aria-hidden="true">4.9.</strong> DossierCreated</a></li><li class="chapter-item expanded "><a href="events/dossier-expense-added.html"><strong aria-hidden="true">4.10.</strong> ExpensesAddedToDossier</a></li><li class="chapter-item expanded "><a href="events/dossier-expense-removed.html"><strong aria-hidden="true">4.11.</strong> ExpenseRemovedFromDossier</a></li><li class="chapter-item expanded "><a href="events/dossier-invoice-added.html"><strong aria-hidden="true">4.12.</strong> InvoiceAddedToDossier</a></li><li class="chapter-item expanded "><a href="events/dossier-invoice-removed.html"><strong aria-hidden="true">4.13.</strong> InvoiceRemovedFromDossier</a></li><li class="chapter-item expanded "><a href="events/dossier-closed.html"><strong aria-hidden="true">4.14.</strong> DossierClosed</a></li><li class="chapter-item expanded "><a href="events/dossier-deleted.html"><strong aria-hidden="true">4.15.</strong> DossierDeleted</a></li><li class="chapter-item expanded "><a href="events/dossier-updated.html"><strong aria-hidden="true">4.16.</strong> DossierUpdated</a></li><li class="chapter-item expanded "><a href="events/dossier-recall.html"><strong aria-hidden="true">4.17.</strong> DossierRecallForModification</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Openartcoded - Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="break-before: page; page-break-before: always;"></div><h1 id="about-this-project"><a class="header" href="#about-this-project">About this project</a></h1>
<p>This project aims to automate as much as possible the administrative work for a freelance developer.</p>
<p>Tldr; everything you need to reproduce my setup can be found on <a href="https://github.com/openartcoded/app-docker" target="_blank">github</a></p>
<p>Check out the installation guides for more details on how to do it.</p>
<h2 id="screenshots"><a class="header" href="#screenshots">Screenshots</a></h2>
<p><img src="images/expense-backoffice.png" alt="Expenses" /></p>
<p><img src="images/invoice-backoffice.png" alt="Invoice" /></p>
<p><img src="images/dossier-backoffice.png" alt="Dossier" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features--technology-stack"><a class="header" href="#features--technology-stack">Features &amp; Technology stack</a></h1>
<p>Various technologies are used in this project:</p>
<ul>
<li>Docker &amp; Docker Compose</li>
<li>Java 17</li>
<li>Maven</li>
<li>NodeJS 16.10</li>
<li>Angular 13</li>
<li>Spring boot</li>
<li>Spring Cloud Gateway</li>
<li>MongoDB</li>
<li>ActiveMQ Artemis</li>
<li>Jena &amp; Jena TDB2</li>
<li>Keycloak</li>
<li>Postgres</li>
<li>Greenmail</li>
</ul>
<p>There are two UI frontends, the public website and the oauth protected backoffice. 
Some API's are public, while most require a valid JWT token to be called.</p>
<p>A non-exhaustive list of features are presented in the next pages.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="website"><a class="header" href="#website">Website</a></h1>
<p>The public website, for an example of what it looks like, visits <a href="https://bittich.be" target="_blank">https://bittich.be</a></p>
<ul>
<li>Automatic SEO for blog posts &amp; CV</li>
<li>Gallery</li>
<li>Contact</li>
<li>Sparql endpoint (<code>select/ask/construct/describe</code> queries only)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backoffice"><a class="header" href="#backoffice">Backoffice</a></h1>
<ul>
<li><strong>Dossiers</strong>
<ul>
<li>Add processed expenses &amp; invoices to the ongoing quarter dossier</li>
<li>Gets an overview of how much you charged and how much you spent during a quarter with plots &amp; CSV</li>
<li>Generate a zip folder with expenses / invoices in it, to send to your accountant</li>
<li>Search an expense or an invoice processed in a quarter</li>
</ul>
</li>
<li><strong>Expenses</strong>
<ul>
<li>Listen to a chosen adress email where you often receive expenses (as a pdf or image attachment)</li>
<li>Upload an expense manually</li>
<li>Tag an expense with default hvat &amp; vat prices (e.g &quot;internet&quot; )</li>
<li>Process an expense (send to the active dossier)</li>
<li>Search an expense by different criterias (name, description, tag, date between,...)</li>
</ul>
</li>
<li><strong>Invoices</strong>
<ul>
<li>Create an invoice with predefined parameters (Default client ) or from an existing invoice</li>
<li>Add your daily rate, the way you charge (per hour / per day) etc</li>
<li>Upload your own template using Freemarker &amp; html</li>
<li>Pdf generation</li>
<li>Summary (total days worked this year, total charged, plots,...)</li>
<li>Process an invoice (send to the active dossier)</li>
</ul>
</li>
<li><strong>Documents</strong>
<ul>
<li>Keep your administrative documents in one place (contracts,...)</li>
<li>Search a document based on different criterias (title, description, date between, tag)</li>
</ul>
</li>
<li><strong>Curriculum</strong>
<ul>
<li>Keep your CV up to date (personal info, experiences, skills,...)</li>
<li>Generates your CV as a PDF using a predefined template</li>
<li>Change the template using Freemarker &amp; html</li>
<li>Import/Export your CV to json</li>
<li>Public parts of the CV are displayed on your website, personal infos can't be accessed unless a request form is filled</li>
<li>Publish the public parts of your CV to a RDF triplestore</li>
</ul>
</li>
<li><strong>Tasks</strong>
<ul>
<li>Create custom tasks to be triggered on a specific date or by cron expression</li>
<li>Action tasks allows you to automate backend tasks (dump database, restore a database from a previous state, backup dossiers, timesheet generation,...)</li>
<li>In app &amp; email notification when a task is triggered</li>
</ul>
</li>
<li><strong>Timesheet (to be refined)</strong>
<ul>
<li>Generates timesheets for a specific month or for the whole year using an action task</li>
<li>Fill your timesheet accurately (start/stop button)</li>
<li>Generates a timesheet to PDF with your digital signature</li>
</ul>
</li>
<li><strong>Gallery</strong>
<ul>
<li>Basic Instagram like feature for your public website</li>
<li>Choose a specific date to make an image visible</li>
</ul>
</li>
<li><strong>Sparql Endpoint</strong>
<ul>
<li>Insert / Query the pre-installed RDF triplestore using yasgui</li>
<li>All triples uploaded will be public</li>
</ul>
</li>
<li><strong>Finance</strong>
<ul>
<li>Search over yahoo finance stocks you are interested in</li>
<li>create portfolios &amp; add stocks to it</li>
<li>Plots</li>
</ul>
</li>
<li><strong>Uploads</strong>
<ul>
<li>Every files generated or uploaded in your app can be searched there</li>
</ul>
</li>
<li><strong>Prospects</strong>
<ul>
<li>Allow people to contact you thought your website without providing your email address</li>
<li>Receive an in-app notification when someone tries to contact you</li>
</ul>
</li>
<li><strong>Blog</strong>
<ul>
<li>Create posts, upload images, code,... with a rich text editor</li>
<li>Draft are not published</li>
</ul>
</li>
<li><strong>Misc / toolbox</strong>
<ul>
<li>Base64 Encode/Decode</li>
<li>XPath / JsonPath</li>
<li>Date manipulation</li>
<li>RDF tools, file / text conversion from an rdf format to another, shacl validation</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>You need at least <code>git</code>, <code>docker</code> and <code>docker compose</code> installed on your machine to run the whole stack.</p>
<p>Additionally, if you want to develop in one of the components, you will need to have installed:</p>
<pre><code>- JDK 17+
- NodeJs 16.10+
- Angular cli 13+
</code></pre>
<p>It has been tested on linux, mac and windows, although on windows you might have to adapt some of the scripts.</p>
<p>There are different ways of running the stack, either locally (for e.g testing, development), or for production. </p>
<h3 id="testing-frontend-development"><a class="header" href="#testing-frontend-development">Testing, frontend development</a></h3>
<p>If you just want to contribute in one of the frontends, or simply testing it without having to compile the backends, follow these steps:</p>
<p><a href="installation/./compiled.html">Frontend development</a></p>
<h3 id="full-stack-development"><a class="header" href="#full-stack-development">Full-stack development</a></h3>
<p>If you'd like to contribute in both backend and frontend, follow these steps:</p>
<p><a href="installation/./monorepo.html">Full-Stack Development</a></p>
<h3 id="production"><a class="header" href="#production">Production</a></h3>
<p>Deployment to production is described here:</p>
<p><a href="installation/./production/index.html">Production</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing-frontend-development-1"><a class="header" href="#testing-frontend-development-1">Testing, Frontend development</a></h1>
<p>Clone the following repository</p>
<pre><code class="language-bash">git clone https://github.com/openartcoded/app-docker.git
</code></pre>
<p>Go to the directory</p>
<pre><code class="language-bash">cd app-docker
</code></pre>
<p>Copy the <strong>.env</strong> file</p>
<pre><code class="language-bash">cp .env.dev.example .env
</code></pre>
<blockquote>
<p>For windows users, you will need to change the content of the file with:</p>
<p><code>COMPOSE_FILE=docker-compose.yml;docker-compose.dev.yml</code></p>
</blockquote>
<p>Once done, up the stack:</p>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<p>In the terminal, run:</p>
<pre><code class="language-bash">docker exec -it app-docker-keycloak-1 /opt/keycloak/bin/kc.sh import \
        --file /tmp/import/artcoded-realm.json
</code></pre>
<blockquote>
<p>For Windows users</p>
</blockquote>
<pre><code class="language-bash">docker exec -it app-docker-keycloak-1 /opt/keycloak/bin/kc.sh import --file /tmp/import/artcoded-realm.json
</code></pre>
<p>Add the following into your <code>/etc/hosts</code></p>
<pre><code class="language-text">    127.0.1.1       auth.somehost.org
    127.0.1.1       somehost.org
    127.0.1.1       backoffice.somehost.org
    127.0.1.1       mail.somehost.org
</code></pre>
<p>Open a private browsing window and visit <a href="https://backoffice.somehost.org">BackOffice</a></p>
<p>Default credentials:</p>
<pre><code class="language-txt">    username: nordine
    password: 1234
</code></pre>
<blockquote>
<p>If you get multiple warnings from your browser when opening the link, this is normal. Certificates are self-signed (only local)</p>
</blockquote>
<h3 id="expenses--reminder-tasks-features"><a class="header" href="#expenses--reminder-tasks-features">Expenses &amp; Reminder Tasks features</a></h3>
<p>Expenses management &amp; reminder tasks use email to receive expenses from a known email address (in the case of expenses),
and send email in case of a reminder task. To test both features, follow these instructions:</p>
<ul>
<li>
<p>On the top-right  of <code>https://backoffice.somehost.org</code>, click on &quot;Personal Info&quot; then &quot;Contact/Bank&quot;
and change the email address to <code>noreply@somehost.com</code></p>
</li>
<li>
<p>Open a new tab &amp; Go to <code>https://mail.somehost.org</code> . You can login with <code>username: noreply@somehost.com , password: noreply</code></p>
</li>
<li>
<p>Send an email with an attachment (pdf or image) to <code>fee@somehost.com</code> =&gt; after a few seconds you should see a notification coming in on <code>https://backoffice.somehost.org</code></p>
</li>
<li>
<p>Create a new reminder task. Choose &quot;Send Mail&quot;. Once the task is triggered, go back to <code>https://mail.somehost.org</code> and login, you should see an email with the reminder.</p>
</li>
</ul>
<h3 id="contribute-to-the-frontend-of-the-public-website"><a class="header" href="#contribute-to-the-frontend-of-the-public-website">Contribute to the frontend of the public website</a></h3>
<p>Clone the following repo:</p>
<pre><code class="language-bash">git clone https://github.com/openartcoded/website.git
</code></pre>
<p>Go to the directory</p>
<pre><code class="language-bash">cd website
</code></pre>
<p>Run npm install</p>
<pre><code class="language-bash">npm i
</code></pre>
<p>Run ng serve</p>
<pre><code class="language-bash">ng serve
</code></pre>
<p>Visit <a href="http://localhost:4200">http://localhost:4200</a></p>
<h3 id="contribute-to-the-frontend-of-the-backoffice"><a class="header" href="#contribute-to-the-frontend-of-the-backoffice">Contribute to the frontend of the backoffice</a></h3>
<p>Clone the following repository</p>
<pre><code class="language-bash">git clone https://github.com/openartcoded/backoffice.git
</code></pre>
<p>Go to the directory</p>
<pre><code class="language-bash">cd backoffice
</code></pre>
<p>Run npm install</p>
<pre><code class="language-bash">npm i
</code></pre>
<p>Run ng serve</p>
<pre><code class="language-bash">ng serve
</code></pre>
<p>Visit <a href="http://localhost:4200">http://localhost:4200</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="full-stack-development-1"><a class="header" href="#full-stack-development-1">Full-stack development</a></h1>
<p>Clone the following repo:</p>
<pre><code>git clone git@github.com:openartcoded/monorepo.git

</code></pre>
<blockquote>
<p>You need a valid SSH public key linked to your github account</p>
</blockquote>
<p>If it's the first time that you clone the repo, you then need to run within the cloned folder:</p>
<p><code>git submodule update --init --recursive --remote</code></p>
<p>Next time you want to update all repo, run the following command: </p>
<p><code>git submodule update --recursive --remote</code></p>
<p>Go to:</p>
<p><code>cd app-docker/</code></p>
<p>Copy the .env file:</p>
<pre><code>cp .env.monorepo.example .env
</code></pre>
<blockquote>
<p>For windows users, you will need to change the content of the file with:</p>
<p><code>COMPOSE_FILE=docker-compose.yml;docker-compose.monorepo.yml</code></p>
</blockquote>
<p>Build the stack:</p>
<pre><code>docker compose build
</code></pre>
<p>Once done, up the stack:</p>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<p>In the terminal, run:</p>
<pre><code class="language-bash">docker exec -it app-docker-keycloak-1 /opt/keycloak/bin/kc.sh import \
        --file /tmp/import/artcoded-realm.json
</code></pre>
<blockquote>
<p>For Windows users</p>
</blockquote>
<pre><code class="language-bash">docker exec -it app-docker-keycloak-1 /opt/keycloak/bin/kc.sh import --file /tmp/import/artcoded-realm.json
</code></pre>
<p>Add the following into your <code>/etc/hosts</code></p>
<pre><code class="language-text">    127.0.1.1       auth.somehost.org
    127.0.1.1       somehost.org
    127.0.1.1       backoffice.somehost.org
    127.0.1.1       mail.somehost.org
</code></pre>
<p>Open a private browsing window and visit <a href="https://backoffice.somehost.org">BackOffice</a></p>
<p>Default credentials:</p>
<pre><code class="language-txt">    username: nordine
    password: 1234
</code></pre>
<blockquote>
<p>If you get multiple warnings from your browser when opening the link, this is normal. Certificates are self-signed (only local)</p>
</blockquote>
<h3 id="expenses--reminder-tasks-features-1"><a class="header" href="#expenses--reminder-tasks-features-1">Expenses &amp; Reminder Tasks features</a></h3>
<p>Expenses management &amp; reminder tasks use email to receive expenses from a known email address (in the case of expenses),
and send email in case of a reminder task. To test both features, follow these instructions:</p>
<ul>
<li>
<p>On the top-right  of <code>https://backoffice.somehost.org</code>, click on &quot;Personal Info&quot; then &quot;Contact/Bank&quot;
and change the email address to <code>noreply@somehost.com</code></p>
</li>
<li>
<p>Open a new tab &amp; Go to <code>https://mail.somehost.org</code> . You can login with <code>username: noreply@somehost.com , password: noreply</code></p>
</li>
<li>
<p>Send an email with an attachment (pdf or image) to <code>fee@somehost.com</code> =&gt; after a few seconds you should see a notification coming in on <code>https://backoffice.somehost.org</code></p>
</li>
<li>
<p>Create a new reminder task. Choose &quot;Send Mail&quot;. Once the task is triggered, go back to <code>https://mail.somehost.org</code> and login, you should see an email with the reminder.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-in-production"><a class="header" href="#using-in-production">Using in production</a></h1>
<p>This is not an exhaustive step-by-step guide on how you might install it into production. </p>
<p>It should be fairly easy if you look a little bit to the code &amp; config properties that you can override.</p>
<p>You need a valid domain, and map your server IP to these domains (CNAME A):</p>
<pre><code>&lt;your-domain&gt;.com
www.&lt;your-domain&gt;.com
auth.&lt;your-domain&gt;.com
backoffice.&lt;your-domain&gt;.com
cube.&lt;your-domain&gt;.com
</code></pre>
<p>Clone the following repo on your server:</p>
<pre><code>git clone https://github.com/openartcoded/app-docker.git

</code></pre>
<p>Checkout the latest stable-ish release, for example:</p>
<pre><code>git checkout v2022.1.0
</code></pre>
<p>Copy the docker-compose.override.example.yml file:</p>
<pre><code>cp docker-compose.override.example.yml docker-compose.override.yml
</code></pre>
<p>Open <code>docker-compose.override.yml</code> with your favorite editor and changes the following properties:</p>
<table><thead><tr><th>Property</th><th>Example</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>MONGO_INITDB_ROOT_USERNAME</strong></td><td>mongo</td><td>username for the mongo database</td></tr>
<tr><td><strong>MONGO_INITDB_ROOT_PASSWORD</strong></td><td>mongo</td><td>password for the mongo database</td></tr>
<tr><td><strong>CAMEL_MAIL_IMAP_USERNAME</strong></td><td>expense@your-domain.com</td><td>Email account that will receive expenses</td></tr>
<tr><td><strong>CAMEL_MAIL_IMAP_PASSWORD</strong></td><td>secret_password</td><td>Password of the expense email address</td></tr>
<tr><td><strong>MAIL_SENDER_USERNAME</strong></td><td>noreply@your-domain.com</td><td>Email account that will send email</td></tr>
<tr><td><strong>MAIL_SENDER_PASSWORD</strong></td><td>secret_password</td><td>Email account pwd that will send email</td></tr>
<tr><td><strong>ARTEMIS_PASSWORD</strong></td><td>secret_password</td><td>Artemis password</td></tr>
<tr><td><strong>POSTGRES_PASSWORD</strong></td><td>secret_password</td><td>Postgres password for keycloak</td></tr>
<tr><td><strong>DRIVE_APPLICATION_NAME</strong></td><td>yourdomain</td><td>Google drive application's name</td></tr>
<tr><td><strong>KEYCLOAK_HOSTNAME</strong></td><td>auth.somehost.org</td><td>Keycloak's hostname</td></tr>
</tbody></table>
<blockquote>
<p>If you're familiar with docker secrets, it is a better way of doing this</p>
</blockquote>
<p>Change all network aliases with your domain:</p>
<pre><code>  keycloak: 
    networks:
      artcoded:
        aliases:
          - auth.your-domain.com

  roundcube:
    image: roundcube/roundcubemail:latest
    networks:
      artcoded:
        aliases:
          - cube.your-domain.com
  ...

</code></pre>
<p>Modify your gateways based on <code>config/gateway-dev.yml</code></p>
<h3 id="google-drive"><a class="header" href="#google-drive">Google Drive</a></h3>
<p>In order to send your backups into google drive, you need to create an application : <code>https://developers.google.com/drive</code></p>
<blockquote>
<p>This is an optional feature, for now the services using it can be commented.</p>
</blockquote>
<h3 id="https-proxy"><a class="header" href="#https-proxy">Https proxy</a></h3>
<p>You can use the same configuration as me, simply put your certificates at the right places and adapt the configuration accordingly:</p>
<pre><code>git clone https://github.com/openartcoded/proxy-nginx
</code></pre>
<h3 id="keycloak"><a class="header" href="#keycloak">Keycloak</a></h3>
<p>You have to generate your own realm, users &amp; roles. Go to https://auth.your-domain.com to proceed.</p>
<blockquote>
<p>You might have to uncomment :
#KEYCLOAK_USER: <strong>KEYCLOAK_USER</strong><br />
#KEYCLOAK_PASSWORD: <strong>KEYCLOAK_PASSWORD</strong></p>
</blockquote>
<h3 id="prometheus--grafana"><a class="header" href="#prometheus--grafana">Prometheus &amp; Grafana</a></h3>
<p>You might have to change the <code>user</code>in docker-composer.override.yml if it's not 1000. </p>
<p>For prometheus, you probably need to create a service account &amp; a role &quot;ROLE_PROMETHEUS&quot; on keycloak (see config/prometheus_dev.yml for an example of prometheus config)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>You can subscribe to the artemis topic <code>backend-event</code> (that name can be overrided with property <code>EVENT_TOPIC_PUBLISH</code> ) in order to
consume events produced by the main monolith. </p>
<p>Depending on the <a href="https://activemq.apache.org/components/artemis/documentation/latest/protocols-interoperability.html">protocol</a> you choose to connect to artemis, you may have the ability to know what's the type of the event received
using the header <code>EventType</code>. This can be handy to ease filtering on the events you're not interested in.</p>
<p>In order to be able to download the different attachments, you must create a new service account on keycloak with role <code>SERVICE_ACCOUNT_DOWNLOAD</code>.</p>
<p>From your docker container, you can then make api calls to <code>http://api-backend/api/download</code> using your oauth secret key.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expensereceived"><a class="header" href="#expensereceived">ExpenseReceived</a></h1>
<p>An expense has been either manually uploaded or received from mail.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><code>{
    &quot;expenseId&quot;:&quot;75e76933-0763-4ea2-aa60-112abdc35607&quot;,
    &quot;name&quot;:&quot;facture telenet avril 2022&quot;,
    &quot;uploadIds&quot;:[
        &quot;626d1bddeb0053093002af04&quot;
    ],
    &quot;version&quot;:&quot;V1&quot;,
    &quot;timestamp&quot;:1651317725451,
    &quot;eventName&quot;:&quot;ExpenseReceived&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expenselabelupdated"><a class="header" href="#expenselabelupdated">ExpenseLabelUpdated</a></h1>
<p>Label for expense has been updated.</p>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<pre><code>{
   &quot;expenseId&quot;:&quot;75e76933-0763-4ea2-aa60-112abdc35607&quot;,
   &quot;label&quot;:&quot;GAS&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;priceHVat&quot;:21.3,
   &quot;vat&quot;:12.4,
   &quot;timestamp&quot;:1651318614557,
   &quot;eventName&quot;:&quot;ExpenseLabelUpdated&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expensepriceupdated"><a class="header" href="#expensepriceupdated">ExpensePriceUpdated</a></h1>
<p>Expense's price has been updated.</p>
<h2 id="example-2"><a class="header" href="#example-2">Example</a></h2>
<pre><code>{
   &quot;expenseId&quot;:&quot;75e76933-0763-4ea2-aa60-112abdc35607&quot;,
   &quot;priceHVat&quot;:21.3,
   &quot;vat&quot;:12.4,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651318875738,
   &quot;eventName&quot;:&quot;ExpensePriceUpdated&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expenseremoved"><a class="header" href="#expenseremoved">ExpenseRemoved</a></h1>
<p>When an expense is deleted from the database. Attachments are also deleted, thus we share again the list of upload ids so you can synchronize easier.</p>
<h2 id="example-3"><a class="header" href="#example-3">Example</a></h2>
<pre><code>{
   &quot;expenseId&quot;:&quot;4ff2f988-7c0a-424f-b988-45d6b9f8c6d4&quot;,
   &quot;uploadIds&quot;:[
      &quot;6260f93eb6fe2120e0d8d960&quot;
   ],
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651319378888,
   &quot;eventName&quot;:&quot;ExpenseRemoved&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expenseattachmentremoved"><a class="header" href="#expenseattachmentremoved">ExpenseAttachmentRemoved</a></h1>
<p>When an attachment is removed from an expense. E.g when forwarding an email with attachment, you may also forward some jpeg related to the signature of the sender.
You don't want this in your db.</p>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<pre><code>{
   &quot;expenseId&quot;:&quot;2ea6d52f-4f90-4e8c-b6c2-91fc715ec37b&quot;,
   &quot;uploadId&quot;:&quot;626d2322eb0053093002af07&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651319597558,
   &quot;eventName&quot;:&quot;ExpenseAttachmentRemoved&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoicegenerated"><a class="header" href="#invoicegenerated">InvoiceGenerated</a></h1>
<p>New invoice generated.</p>
<h2 id="example-5"><a class="header" href="#example-5">Example</a></h2>
<pre><code>{
   &quot;invoiceId&quot;:&quot;a0f413ed-d7c7-4d03-8f4c-3af75a9a407d&quot;,
   &quot;uploadId&quot;:&quot;626d2537eb0053093002af0f&quot;,
   &quot;manualUpload&quot;:false,
   &quot;subTotal&quot;:17850.00,
   &quot;taxes&quot;:3748.50,
   &quot;invoiceNumber&quot;:&quot;042022-WO&quot;,
   &quot;dateOfInvoice&quot;:1651276800000,
   &quot;dueDate&quot;:1653861600000,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320119631,
   &quot;eventName&quot;:&quot;InvoiceGenerated&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoiceremoved"><a class="header" href="#invoiceremoved">InvoiceRemoved</a></h1>
<p>Invoice deleted. It can be marked either a logical delete (invoice can be restored), or a hard delete (invoice is completely deleted)</p>
<h2 id="example-6"><a class="header" href="#example-6">Example</a></h2>
<pre><code>{
   &quot;invoiceId&quot;:&quot;f1688ed4-130f-4486-97af-d903e1bbf990&quot;,
   &quot;uploadId&quot;:&quot;626d2537eb0053093002af0f&quot;,
   &quot;logicalDelete&quot;:true,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320225861,
   &quot;eventName&quot;:&quot;InvoiceRemoved&quot;
}  
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoicerestored"><a class="header" href="#invoicerestored">InvoiceRestored</a></h1>
<p>Invoice restored. </p>
<h2 id="example-7"><a class="header" href="#example-7">Example</a></h2>
<pre><code>{
   &quot;invoiceId&quot;:&quot;f1688ed4-130f-4486-97af-d903e1bbf990&quot;,
   &quot;uploadId&quot;:&quot;62542bd52f5b1775103143a1&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320353569,
   &quot;eventName&quot;:&quot;InvoiceRestored&quot;
} 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dossiercreated"><a class="header" href="#dossiercreated">DossierCreated</a></h1>
<p>New dossier created.</p>
<h2 id="example-8"><a class="header" href="#example-8">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;name&quot;:&quot;Q2-2022&quot;,
   &quot;description&quot;:&quot;pay your taxes before xxx&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651319048150,
   &quot;tvaDue&quot;:null,
   &quot;eventName&quot;:&quot;DossierCreated&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expensesaddedtodossier"><a class="header" href="#expensesaddedtodossier">ExpensesAddedToDossier</a></h1>
<p>When expenses are added to the active dossier.</p>
<h2 id="example-9"><a class="header" href="#example-9">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;expenseIds&quot;:[
      &quot;3fb1738f-6dd3-4c98-a02c-2a810ece40e9&quot;,
      &quot;75e76933-0763-4ea2-aa60-112abdc35607&quot;
   ],
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651319137349,
   &quot;eventName&quot;:&quot;ExpensesAddedToDossier&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expenseremovedfromdossier"><a class="header" href="#expenseremovedfromdossier">ExpenseRemovedFromDossier</a></h1>
<p>When an expense is removed from the active dossier. It goes back to the list of unprocessed expenses.</p>
<h2 id="example-10"><a class="header" href="#example-10">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;expenseId&quot;:&quot;3fb1738f-6dd3-4c98-a02c-2a810ece40e9&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651319817784,
   &quot;eventName&quot;:&quot;ExpenseRemovedFromDossier&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoiceaddedtodossier"><a class="header" href="#invoiceaddedtodossier">InvoiceAddedToDossier</a></h1>
<p>When an invoice is added to the active dossier.</p>
<h2 id="example-11"><a class="header" href="#example-11">Example</a></h2>
<pre><code>
{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;invoiceId&quot;:&quot;a0f413ed-d7c7-4d03-8f4c-3af75a9a407d&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320564289,
   &quot;eventName&quot;:&quot;InvoiceAddedToDossier&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoiceremovedfromdossier"><a class="header" href="#invoiceremovedfromdossier">InvoiceRemovedFromDossier</a></h1>
<p>When an invoice is removed from the active dossier. It goes back to the unprocessed list of invoices</p>
<h2 id="example-12"><a class="header" href="#example-12">Example</a></h2>
<pre><code>
{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;invoiceId&quot;:&quot;a0f413ed-d7c7-4d03-8f4c-3af75a9a407d&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320793125,
   &quot;eventName&quot;:&quot;InvoiceRemovedFromDossier&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dossierclosed"><a class="header" href="#dossierclosed">DossierClosed</a></h1>
<p>When the dossier is closed and the zip file is generated. Zip file can be downloaded by using the uploadId.</p>
<h2 id="example-13"><a class="header" href="#example-13">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;a24e831f-8adb-4aad-9b5a-59818751d92f&quot;,
   &quot;uploadId&quot;:&quot;626d2888eb0053093002af12&quot;,
   &quot;name&quot;:&quot;Q2-2022&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651320968785,
   &quot;eventName&quot;:&quot;DossierClosed&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dossierdeleted"><a class="header" href="#dossierdeleted">DossierDeleted</a></h1>
<p>Active dossier deleted. This can only happen if there are no expenses &amp; no invoices in the active dossier.</p>
<h2 id="example-14"><a class="header" href="#example-14">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;5954c7a6-a30e-4c4d-b24f-b6570c638da8&quot;,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651321094592,
   &quot;eventName&quot;:&quot;DossierDeleted&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dossierupdated"><a class="header" href="#dossierupdated">DossierUpdated</a></h1>
<p>Dossier updated.</p>
<h2 id="example-15"><a class="header" href="#example-15">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;5fdc6362-970a-4812-a1f9-b93e35c3fa96&quot;,
   &quot;name&quot;:&quot;AZ-32&quot;,
   &quot;description&quot;:&quot;I changed smth&quot;,
   &quot;tvaDue&quot;:null,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651321322408,
   &quot;eventName&quot;:&quot;DossierUpdated&quot;
}
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dossierrecallformodification"><a class="header" href="#dossierrecallformodification">DossierRecallForModification</a></h1>
<p>When the dossier is already closed but you received from your accountant how much VAT you have to pay .</p>
<h2 id="example-16"><a class="header" href="#example-16">Example</a></h2>
<pre><code>{
   &quot;dossierId&quot;:&quot;5fdc6362-970a-4812-a1f9-b93e35c3fa96&quot;,
   &quot;tvaDue&quot;:7893.12,
   &quot;version&quot;:&quot;V1&quot;,
   &quot;timestamp&quot;:1651321322408,
   &quot;eventName&quot;:&quot;DossierRecallForModification&quot;
}
    
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
